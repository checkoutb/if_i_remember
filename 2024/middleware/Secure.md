Secure
2021年12月10日
13:28

=============================

https://www.cnblogs.com/demon28/p/8036873.html

OAuth

=============================

=============================

https://juejin.cn/post/7116520783534522399
保证接口数据安全的10种方式

1. 数据加密，防止报文明文传输
如果使用http，因为是明文传输，所以数据容易被别人获取。

常见的实现方式，就是对  关键字段加密，比如，你登录一个接口，你可以对  密码加密。
简单的加密是  对称加密算法(如AES)，或hash算法处理(如MD5)
更安全的是，非对称加密(如RSA  或  SM2)。  公钥加密，私钥解密。

如果你要对所有字段加密，一般推荐使用https。https实际上就是在http  和  tcp  之间  加一层加密层ssl。

https原理

![计算机生成了可选文字: 发起HTT请求 轮证致孚证 返回孚证制（公， 兰过？ 证00在到 对0三诖， 用公掮 用过己的乶 服隽器 到客F00诉 一0陔才过](../_resources/72535e78673b480cb82c1d06d04e6acd.jpg)

客户端发起Https请求，连接到服务器的443端口。
服务器必须要有一套数字证书（证书内容有公钥、证书颁发机构、失效日期等）。
服务器将自己的数字证书发送给客户端（公钥在证书里面，私钥由服务器持有）。
客户端收到数字证书之后，会验证证书的合法性。如果证书验证通过，就会生成一个随机的对称密钥，用证书的公钥加密。
客户端将公钥加密后的密钥发送到服务器。

服务器接收到客户端发来的密文密钥之后，用自己之前保留的私钥对其进行非对称解密，解密之后就得到客户端的密钥，然后用客户端密钥对返回数据进行对称加密，酱紫传输的数据都是密文啦。

服务器将加密后的密文返回到客户端。
客户端收到后，用自己的密钥对其进行对称解密，得到服务器返回的数据。

日常业务，数据传输加密，https就可以了。  如果安全性要求较高，如，登录，注册等，这些需要传输密码的，密码可以用  RSA  等  非对称加密  加密。  如果业务的安全性要求很高，你可以模拟https这个流程，对报文  再做一次加解密。

1. 数据加签验签
数据报文加签验签，是保证数据传输安全的  常用手段，它可以保证数据在  传输过程中  不被篡改。

什么是加签验签？

数据加签：用hash算法(如MD5，SHA-256)  把原始请求参数  生成报文摘要，然后用私钥  对这个摘要进行加密，就得到这个报文对应的  数字签名  sign (这个过程就是  加签)。通常来说，请求方会把  数字签名  和  报文原文  一并发给  接收方。

验签：接收方得到  原始报文  和  数字签名后，  用同一个hash算法  从  报文中  生成  摘要A。然后用  对方提供的  公钥  对数字签名  进行解密，得到  摘要B，对比  A B  是否相同，就可以知道  报文有没有被  篡改。

https加密的部分  只是在外网，然后很多服务是  内网相互跳转的，加签也可以保证  在这里  不被任何  中间人篡改。  所以一般转账类  安全性要求高的  接口开发，都要  加签验签。

1. token  授权认证机制
网站，app都是需要  用户登录的，  那么如果是  非登录接口，如何确保安全，如何确认用户身份。

token授权认证方案

用户在  客户端输入用户名和密码，  点击登录后，服务器  校验密码成功，给  客户端返回一个  唯一值  token，并将token以  键值对的形式存放在  缓存(一般是redis)中，后续  client  对需要  授权模块  的所有  操作  都要带上这个  token，服务器接收请求后，先进行  token  验证，如果  token存在，才表明是  合法请求。

用户输入用户名和密码，发起登录请求
服务端校验密码，如果校验通过，生成一个全局唯一的token。
将token存储在redis中，其中key是token，value是userId或者是用户信息，设置一个过期时间。
把这个token返回给客户端
用户发起其他业务请求时，需要带上这个token
后台服务会统一拦截接口请求，进行token有效性校验，并从中获取用户信息，供后续业务逻辑使用。如果token不存在，说明请求无效。

如何保证token安全，如果token被劫持呢。
token设置合理的有效期
https协议
token可以再次加密
白名单

jwt也是token  的一种。

1. 时间戳timestamp超时机制

数据是很容易抓包的，如果使用了  https  和  加签，即使中间人  拿到了  数据报文，它也看不到  真实数据，但是  有些人  不关心  真实的数据，而是  直接  拿  抓到的包  进行  DDOS。

我们可以使用  时间戳超时机制，来保证接口安全。  即：用户每次请求  都带上  当前时间的  timestamp，服务器收到  请求后，解密，验签通过后，  与服务器当前  时间对比，如果  时间差  大于  一定时间，则认为  该请求无效。

1. timestamp +  nonce  方案阻止  重放攻击
时间戳超时机制也是有漏洞的，比如在  时间差内，重发，那就不好用了。  可以使用  timestamp + nonce  方案

nonce  指  唯一的随机字符串，用来标识每个  被签名的请求。  我们可以将  每次请求的  nonce参数  存储到一个  set  中。每次处理http请求时，判断下  该请求的  nonce  是否已经在  set中，如果存在，则认为是非法的。

对于服务器来说，  永久保存nonce  的代码很大，所以  可以结合timestamp。  只需要存储  有效期内的  nonce。

1. 限流机制
如果用户是真实用户，但是恶意频繁调用接口。  这时需要  限流。

常用的限流算法有  令牌桶  和  漏桶算法。

可以使用Guava  的  RateLimiter  单机版限流，也可以使用  redis  分布式锁，还可以使用  阿里开源的  sentinel  限流。

1. 黑名单

1. 白名单

1. 数据脱敏掩码
对于手机，密码，身份证  这些敏感信息，一般需要  脱敏，  如果是密码，还需要  加密  再保存到  数据库。

对于手机，身份证，日志中应该  保存  掩码。

对于密码，最简单也要MD5，  spring security  中  BCryptPasswordEncoder  也可以，它底层使用  SHA-256+随机盐+密钥  对密码进行加密。

。。加盐后，下次怎么判断。。

1. 数据参数一些合法性校验
接口数据的安全性保证，  还需要  我们系统，有个  数据合法性  校验，比如  身份证长度，手机号长度，是否数字  等。

=============================

=============================

=============================

=============================

=============================

=============================

=============================

=============================

=============================

=============================

=============================

=============================

=============================

=============================

=============================

=============================

=============================

已使用 Microsoft OneNote 2016 创建。